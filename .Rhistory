```r
knitr::opts_chunk$set(eval = FALSE)
x <- c(1, 2, 3)
y <- c("4", "5", "6")
z <- c(x, y)
class(z)
df <- data.frame(a = 1:3, b = 4:6)
class(df[, 1])                 # "integer" (벡터)
df_sub <- df[, 1, drop = FALSE]
class(df_sub)
x <- c(1, 2, 3)
y <- c("4", "5", "6")
z <- c(x, y)
class(z)
# Default: show code, do not execute (flip to TRUE during live demo)
knitr::opts_chunk$set(echo = TRUE, eval = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
path_clean <- "antihypertensive_dementia_cohort.csv"
# Default: show code, do not execute (flip to TRUE during live demo)
knitr::opts_chunk$set(echo = TRUE, eval = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
path_small <- "antihypertensive_dementia.csv"
path_small <- "data/antihypertensive_dementia.csv"
df <- read.csv(path_small)
head(df); dplyr::glimpse(df)
head(df)
dplyr::glimpse(df)
summary(df[, c("age","bmi","baseline_cognitive_score","outpatient_visits")])
path_small <- "data/antihypertensive_dementia.csv"
df <- read.csv(path_small)
head(df)
dplyr::glimpse(df)
library(dplyr)
glimpse(df)
df %>%
select(patient_id, medication_adherence, age, sex, bmi) %>%
arrange(desc(age)) %>%
head(10)
df %>% filter(medication_adherence == "High", age >= 80) %>% count()
df2 <- df %>%
mutate(
adherent = factor(medication_adherence, levels=c("Low","High")),
senior75 = age >= 75,
bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese"))
) %>%
select(patient_id, adherent, senior75, bmi_class, age, bmi)
head(df2)
df %>%
group_by(medication_adherence) %>%
summarise(
n = n(),
mean_age = mean(age),
female_pct = mean(sex == "Female"),
mean_bmi = mean(bmi),
mean_cog = mean(baseline_cognitive_score),
event_rate = mean(dementia_dx)
)
library(ggplot2)
?geom_histogram
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30, alpha = .6, position = "identity") +
facet_wrap(~medication_adherence, ncol = 1) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30, alpha = .6, position = "stack") +
facet_wrap(~medication_adherence, ncol = 1) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30, alpha = .6, position = "dodge") +
facet_wrap(~medication_adherence, ncol = 1) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30) +
facet_wrap(~medication_adherence, ncol = 1) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30) +
facet_wrap(~medication_adherence) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.1 BMI distribution by adherence
ggplot(df, aes(bmi, fill = medication_adherence)) +
geom_histogram(bins = 30) +
facet_wrap(~medication_adherence, ncol = 1) +
labs(title = "BMI Distribution by Medication Adherence")
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .3) + geom_smooth(se = FALSE) +
labs(title = "Cognitive Score vs Age")
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .3) + geom_smooth(metho = "lm", se = FALSE) +
labs(title = "Cognitive Score vs Age")
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .3) + geom_smooth(method = "lm", se = FALSE) +
labs(title = "Cognitive Score vs Age")
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .3) +
labs(title = "Cognitive Score vs Age")
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .6) +
labs(title = "Cognitive Score vs Age")
?geom_smooth
# 3.2 Cognitive score vs Age
ggplot(df, aes(age, baseline_cognitive_score, color = medication_adherence)) +
geom_point(alpha = .6) + geom_smooth() +
labs(title = "Cognitive Score vs Age")
library(janitor)
install.packages("janitor")
library(janitor)
summary(df["medication_adherence"])
df$medication_adherence
df$medication_adherence = factor(df$medication_adherence)
df$medication_adherence
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
library(dplyr)
library(ggplot2)
# 데이터 불러오기
data <- read.csv("data/antihypertensive_dementia.csv")
# 데이터 미리보기
head(data)
# 데이터 구조 확인
glimpse(data)
summary(data)
# 범주형 변수 빈도
table(data$sex)
table(data$medication_adherence)
table(data$dementia_diagnosis)
data$dementia_dx
table(data$dementia_diagnosis)
table(data$dementia_dx)
ggplot(data, aes(x = age)) +
geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
labs(title = "나이 분포", x = "나이", y = "빈도")
ggplot(data, aes(x = age)) +
geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
labs(title = "Age distribution", x = "Age", y = "Frequency")
ggplot(data, aes(x = bmi)) +
geom_histogram(binwidth = 1, fill = "lightgreen", color = "black") +
labs(title = "BMI distribution", x = "BMI", y = "Frequency")
ggplot(data, aes(x = medication_adherence, fill = medication_adherence)) +
geom_bar() +
labs(title = "항고혈압제 복용 지속성 분포", x = "복용 지속성", y = "빈도")
ggplot(data, aes(x = medication_adherence, fill = medication_adherence)) +
geom_bar() +
labs(title = "Antihypertensive medication adherence", x = "Medication adherence", y = "Frequency")
ggplot(data, aes(x = dementia_dx, y = age, fill = dementia_dx)) +
geom_boxplot() +
labs(title = "Age distribution by dementia diagnosis", x = "Dementia diagnosis", y = "Age")
ggplot(data, aes(x = dementia_dx, y = bmi, fill = dementia_dx)) +
geom_boxplot() +
labs(title = "BMI distribution by dementia diagnosis", x = "Dementia diagnosis", y = "BMI")
t.test(age ~ dementia_dx, data = data)
table_sex_dementia <- table(data$sex, data$dementia_dx)
chisq.test(table_sex_dementia)
knitr::opts_chunk$set(eval = FALSE)
path_dirty <- "data/antihypertensive_dementia.csv"
dfd <- read.csv(path_dirty)
head(dfd)
glimpse(dfd)
summary(dfd)
# 간단한 품질 지표
nrow(dfd); sum(duplicated(dfd))
library(tidyverse)
sapply(dfd[, c("age","bmi","cognitive_score","insurance_quartile")], function(x) mean(is.na(x)))
path_data <- "data/antihypertensive_dementia.csv"
df <- read.csv(path_data)
head(df)
glimpse(df)
summary(df)
# 간단한 품질 지표
sum(duplicated(df))
table(df$sex)
table(df$sex, useNA = "ifany")
table(df$insurance_quartile)
table(df$insurance_quartile, useNA = "ifany")
table(df$num_comorbidities)
table(df$sex)
table(df$insurance_quartile, useNA = "ifany")
table(df$num_comorbidities)
table(df$depression_dx)
plot(density(df$outpatient_visits))
plot(density(df$cognitive_score))
plot(density(df$cognitive_score))
plot(density(df$cognitive_score, na.rm = T))
table(df$medication_adherence)
table(df$sex) # M, F, Male, Female
table(dfd$dementia_dx)
plot(density(df$bmi))
plot(density(df$bmi, na.rm = T))
plot(density(df$time_to_dementia))
range(df$time_to_dementia)
df %>% summarise(
bad_visits = mean(outpatient_visits < 0 | outpatient_visits > 60, na.rm=TRUE),
bad_bmi    = mean(bmi < 15 | bmi > 50, na.rm=TRUE),
bad_time   = mean(time_to_dementia <= 0, na.rm=TRUE)
)
# select / filter / arrange
df %>%
select(id, medication_adherence, age, sex, bmi) %>%
filter(age >= 75 | medication_adherence %in% c("High","H")) %>%
arrange(desc(bmi)) %>%
head(10)
# mutate: 파생변수
df2 <- df %>%
mutate(
adherent_raw = medication_adherence,  # 클리닝 전 원본 레이블 보존
adherent_fac = factor(medication_adherence),
bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese"))
)
# summarise
df2 %>%
group_by(adherent_fac) %>%
summarise(n=n(), mean_age = mean(age, na.rm=TRUE), event_rate = mean(dementia_dx=="Yes", na.rm=TRUE))
# mutate: 파생변수
df2 <- df %>%
mutate(
medication_adherence = factor(medication_adherence),
bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese"))
)
# summarise
df2 %>%
group_by(medication_adherence) %>%
summarise(n=n(), mean_age = mean(age, na.rm=TRUE), event_rate = mean(dementia_dx=="Yes", na.rm=TRUE))
?recode
table(dfd$dementia_dx) # no, No, yes, Yes
table(df$dementia_dx) # no, No, yes, Yes
df$dementia_dx
df3 <- df2 %>%
# 2-1) 라벨 통일
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex),
medication_adherence = recode(medication_adherence, "H"="High","L"="Low", .default = medication_adherence))
df3 <- df2 %>%
# 2-1) 라벨 통일
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex),
medication_adherence = recode(medication_adherence, "H"="High","L"="Low", .default = medication_adherence))
df3 <- df2 %>%
# 2-1) 라벨 통일
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex),
medication_adherence = recode(medication_adherence, "H"="High","L"="Low", .default = medication_adherence))
df2$sex
df3$sex = factor(df3$sex)
df3 <- df2 %>%
# 2-1) 라벨 통일
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex))
df3$sex = factor(df3$sex)
table(df$insurance_quartile, useNA = "ifany")
table(df$num_comorbidities)
table(df$medication_adherence) # H, High, L, Low
df2 <- df %>%
# 2-1) 라벨 통일
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex),
medication_adherence = recode(medication_adherence, "H" = "High", "L" = "Low", .default = medication_adherence),
dementia_dx = recode(dementia_dx, "No" = "no", "Yes" = "yes", .default = dementia_dx))
df3 = df2 %>%
mutate(sex = factor(sex),
medication_adherence = factor(medication_adherence),
dementia_dx = factor(dementia_dx))
summary(df3)
df4 = df3 %>%
mutate(bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese")))
head(df4$bmi_class)
?pmax
pmax(df4$bmi)
pmax(df4$bmi, 15)
df5 = df4 %>%
# 2-2) 간단 결측 처리 (예시: 중앙값/최빈값)
mutate(insurance_quartile = if_else(is.na(insurance_quartile),
median(insurance_quartile, na.rm=TRUE), insurance_quartile),
age = if_else(is.na(age), round(median(age, na.rm=TRUE)), age),
cognitive_score = if_else(is.na(cognitive_score),
median(cognitive_score, na.rm=TRUE), cognitive_score),
bmi = if_else(is.na(bmi), median(bmi, na.rm=TRUE), bmi)
) %>%
# 2-3) 이상치 완화
mutate(
bmi = pmin(pmax(bmi, 15), 50),
outpatient_visits = pmin(pmax(outpatient_visits, 0), 60),
time_to_dementia = if_else(time_to_dementia <= 0, 1, time_to_dementia) # 최소 1개월로 보정
) %>%
# 2-4) 중복 제거
distinct()
df6 = df5 %>%
mutate(bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese")))
glimpse(df6)
df6 %>% summarise(
na_age = mean(is.na(age)),
label_ok = mean(medication_adherence %in% c("High","Low")),
bmi_range_ok = mean(bmi>=15 & bmi<=50),
visits_range_ok = mean(outpatient_visits>=0 & outpatient_visits<=60)
)
range(df5$age)
df6 = df5 %>%
mutate(bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese")),
age_group = cut(age, breaks=c(60,70,80,Inf), right=FALSE))
# 3-1) join: 치매 레이블
dx_dict <- tibble(
dementia_dx = c("NO","YES"),
dementia_label = c("No dementia","Dementia")
)
df6_join <- df6 %>% left_join(dx_dict, by="dementia_dx")
# 3-2) pivot_wider: 연령대 × 복약
tab_age_ad <- df6_join %>%
count(age_group, medication_adherence, name="n") %>%
group_by(age_group) %>%
mutate(pct = n/sum(n))
tab_age_ad %>%
pivot_wider(names_from = medication_adherence,
values_from = c(n, pct))
# 3-3) pivot_longer: wide → long
long_demo <- df6_join %>%
select(id, age, bmi, cognitive_score) %>%
pivot_longer(cols = c(age, bmi, cognitive_score),
names_to = "variable", values_to = "value")
head(long_demo)
library(survival); library(survminer)
df_surv <- df6 %>%
mutate(adherent = factor(medication_adherence, levels=c("Low","High")))
fit_km <- survfit(Surv(time_to_dementia, event) ~ adherent, data = df_surv)
ggsurvplot(fit_km, conf.int = TRUE, risk.table = TRUE,
legend.labs = c("Low","High"),
xlab = "Months", ylab = "Dementia-free survival")
# Log-rank test
survdiff(Surv(time_to_dementia, event) ~ adherent, data = df_surv)
# 사건율 비교
raw_rate <- mean(df$dementia_dx %in% c("Yes","YES"), na.rm=TRUE)
clean_rate <- mean(df6$dementia_dx=="YES", na.rm=TRUE)
c(raw_rate = raw_rate, clean_rate = clean_rate)
library(tidyverse)
path_data <- "data/antihypertensive_dementia.csv"
df <- read.csv(path_data)
head(df)
glimpse(df)
summary(df)
table(df$sex) # M, F, Male, Female
table(df$insurance_quartile, useNA = "ifany")
table(df$num_comorbidities)
table(df$depression_dx)
table(df$medication_adherence) # H, High, L, Low
table(df$dementia_dx) # no, No, yes, Yes
plot(density(df$bmi, na.rm = T))
plot(density(df$outpatient_visits)) # errors, outliers
plot(density(df$cognitive_score, na.rm = T))
plot(density(df$time_to_dementia))
range(df$time_to_dementia)
df %>% summarise(
bad_visits = mean(outpatient_visits < 0 | outpatient_visits > 60, na.rm=TRUE),
bad_bmi    = mean(bmi < 15 | bmi > 50, na.rm=TRUE),
bad_time   = mean(time_to_dementia <= 0, na.rm=TRUE)
)
df2 <- df %>%
mutate(
sex = recode(sex, "M"="Male","F"="Female", .default = sex),
medication_adherence = recode(medication_adherence, "H" = "High", "L" = "Low", .default = medication_adherence),
dementia_dx = recode(dementia_dx, "No" = "no", "Yes" = "yes", .default = dementia_dx))
df3 = df2 %>%
mutate(sex = factor(sex),
medication_adherence = factor(medication_adherence),
dementia_dx = factor(dementia_dx))
summary(df3)
df5 = df4 %>%
# 2-2)
mutate(insurance_quartile = if_else(is.na(insurance_quartile),
median(insurance_quartile, na.rm=TRUE), insurance_quartile),
age = if_else(is.na(age), round(median(age, na.rm=TRUE)), age),
cognitive_score = if_else(is.na(cognitive_score),
median(cognitive_score, na.rm=TRUE), cognitive_score),
bmi = if_else(is.na(bmi), median(bmi, na.rm=TRUE), bmi)
)
df5 = df5 %>%
mutate(
bmi = pmin(pmax(bmi, 15), 50),
outpatient_visits = pmin(pmax(outpatient_visits, 0), 60),
time_to_dementia = if_else(time_to_dementia <= 0, 1, time_to_dementia) # 최소 1개월로 보정
) %>%
distinct() # 중복 제거
df6 = df5 %>%
mutate(bmi_class = cut(bmi, breaks = c(-Inf, 18.5, 25, 30, Inf),
labels = c("Under","Normal","Over","Obese")),
age_group = cut(age, breaks=c(60,70,80,Inf), right=FALSE))
library(survival)
library(survminer)
df_surv <- df6 %>%
mutate(adherent = factor(medication_adherence, levels=c("Low","High")))
fit_km <- survfit(Surv(time_to_dementia, event) ~ adherent, data = df_surv)
ggsurvplot(fit_km, conf.int = TRUE, risk.table = TRUE,
legend.labs = c("Low","High"),
xlab = "Months", ylab = "Dementia-free survival")
survdiff(Surv(time_to_dementia, event) ~ adherent, data = df_surv)
knitr::opts_chunk$set(echo = TRUE, eval = F)
df1 <- data.frame(
country=c("Korea","Japan","China"),
life_exp=c(80,83,67))
df2 <- data.frame(
country=c("Korea","Japan","Taiwan"),
pop_mil=c(50,100,10))
inner_join(df1, df2, by="country")
left_join(df1, df2, by="country")
right_join(df1, df2, by="country")
full_join(df1, df2, by="country")
continent_gapminder <- gapminder %>%
group_by(continent, year) %>%
summarize(lifeExp = mean(lifeExp),
pop = mean(pop),
gdpPercap = mean(gdpPercap))
library(gapminder)
continent_gapminder <- gapminder %>%
group_by(continent, year) %>%
summarize(lifeExp = mean(lifeExp),
pop = mean(pop),
gdpPercap = mean(gdpPercap))
# Wide → Long
long_data <- continent_gapminder %>%
pivot_longer(cols = lifeExp:gdpPercap,
names_to = "variable",
values_to = "value")
# Long → Wide
long_data %>%
pivot_wider(names_from = variable,
values_from = value)
gapminder %>%
filter(year == 2007) %>%
ggplot(aes(x=gdpPercap, y=lifeExp)) +
geom_point()
gapminder %>%
filter(year == 2007) %>%
ggplot(aes(x=gdpPercap, y=lifeExp,
color = continent,
size = pop)) +
geom_point()
gapminder %>%
filter(year == 2007) %>%
ggplot(aes(x=gdpPercap, y=lifeExp,
color = continent,
size = pop)) +
geom_point() +
facet_grid(.~continent)
gapminder_line = gapminder %>%
group_by(continent, year) %>%
summarize(meanLifeExp = mean(lifeExp))
gapminder_line %>%
ggplot(aes(x=year, y=meanLifeExp, color=continent)) +
geom_line()
gapminder %>%
group_by(continent, year) %>%
summarize(meanLifeExp = mean(lifeExp)) %>%
ggplot(aes(x=year, y=meanLifeExp,
color=continent)) +
geom_line()
gapminder %>%
select(continent, country) %>%
distinct() %>%
group_by(continent) %>%
summarize(n = n()) %>%
ggplot(aes(continent, n)) +
geom_col()
gapminder %>%
select(continent, country) %>%
distinct() %>%
ggplot(aes(continent)) +
geom_bar()
gapminder %>%
select(continent, country) %>%
distinct() %>%
ggplot(aes(continent, fill = continent)) +
geom_bar()
gapminder %>%
select(continent, country) %>%
distinct() %>%
ggplot(aes(continent, fill = continent)) +
geom_bar()
ggplot(gapminder, aes(x=lifeExp)) +
geom_histogram()
ggplot(gapminder, aes(x=lifeExp)) + geom_histogram(binwidth = 5)
ggplot(gapminder,
aes(x=continent, y=lifeExp)) +
geom_boxplot()
ggplot(gapminder,
aes(x=continent, y=lifeExp)) +
geom_violin()
ggplot(gapminder,
aes(x=continent, y=lifeExp)) +
geom_boxplot() +
labs(title = "Distribution of life expectancy across different continents",
x = "Continent",
y = "Life expectancy (years)")
ggplot(gapminder,
aes(x=continent, y=lifeExp)) +
geom_boxplot() +
labs(title = "Distribution of life expectancy across different continents",
x = "Continent",
y = "Life expectancy (years)") +
theme(text = element_text(size = 16))
q()
