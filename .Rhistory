gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
select(country, estimate, fit) -> temp
temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
unnest(fit) -> temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
unnest(fit) -> temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
unnest(fit) %>%
select(country, estimate, r.squared) -> temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
select(country, estimate, fit) %>%
unnest(fit) -> temp
temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(param = map(lmod, ~tidy(.x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(param) %>%
filter(term == "gdpPercap") %>%
unnest(fit) %>%
select(country, estimate, r.squared) -> temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(fit) %>%
select(country, estimate, r.squared) -> temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(fit) %>%
select(country, r.squared) -> temp
temp
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(fit) %>%
select(country, r.squared) %>%
slice_max(r.squared, 10)
gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(fit) %>%
select(country, r.squared) %>%
slice_max(r.squared, n=10)
lm_fit = gapminder %>%
group_by(country) %>%
nest() %>%
mutate(lmod = map(data, ~lm(lifeExp ~ gdpPercap, data = .x))) %>%
mutate(fit = map(lmod, ~glance(.x))) %>%
unnest(fit) %>%
select(country, r.squared)
lm_fit %>%
slice_max(r.squared, n=10)
lm_fit %>%
slice_min(r.squared, n=10)
?slice_max
lm_fit %>%
arrange(r.squared)
lm_fit %>%
arrange(desc(r.squared))
# linear mixed effects model
library(lmer)
install.packages("lmer")
# linear mixed effects model
library(lme4)
install.packages("lme4")
# linear mixed effects model
library(lme4)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1/continent))
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1/continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder)
summary(lme_mod)
str(gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1+gdpPercap+year|continent), data = gapminder)
summary(lme_mod)
lme_mod = lmer(lifeExp ~ gdpPercap + (1|year) + (1|continent), data = gapminder)
summary(lme_mod)
lme_mod = lmer(lifeExp ~ gdpPercap + (1|year) + (1|continent), data = gapminder)
summary(lme_mod)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-year and by-continent variability
summary(lme_mod)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-year and by-continent variability
summary(lme_mod)
lme_mod = lmer(lifeExp ~ gdpPercap + year, data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-continent variability
summary(lme_mod)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1+gpdPercap|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1+gdpPercap|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1+gdpPercap|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1 +  gdpPercap|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1 +  year|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent) + (1|country), data = gapminder)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-continent variability
summary(lme_mod)
lme_mod2 = lmer(lifeExp ~ year + (1|continent) + (1|country), data = gapminder)
anova(lme_mod, lme_mod2)
lme_mod = lmer(lifeExp ~ gdpPercap + year + continent + (1|country), data = gapminder)
lme_mod2 = lmer(lifeExp ~ year + continent + (1|country), data = gapminder)
anova(lme_mod, lme_mod2)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-continent variability
summary(lme_mod)
lme_mod2 = lmer(lifeExp ~ year + (1|continent), data = gapminder)
anova(lme_mod, lme_mod2)
gapminder %>%
ggplot(aes(gpdPercap, lifeExp)) +
geom_point() +
facet_wrap(~continent)
gapminder %>%
ggplot(aes(gdpPercap, lifeExp)) +
geom_point() +
facet_wrap(~continent)
gapminder %>%
ggplot(aes(gdpPercap, lifeExp)) +
geom_point() +
facet_wrap(~year)
gapminder %>%
ggplot(aes(continent, lifeExp)) +
geom_boxplot()
gapminder %>%
ggplot(aes(year, lifeExp)) +
geom_boxplot()
gapminder %>%
ggplot(aes(year, lifeExp)) +
geom_boxplot()
gapminder %>%
ggplot(aes(factor(year), lifeExp)) +
geom_boxplot()
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1+gdpPercap|continent), data = gapminder)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder)
lme_mod2 = lmer(lifeExp ~ year + (1|continent), data = gapminder, REML = FALSE)
anova(lme_mod, lme_mod2)
lme_mod = lmer(lifeExp ~ gdpPercap + year + (1|continent), data = gapminder, REML = FALSE)
# a linear regression model that uses gdpPercap to predict lifeExp, controlling for by-continent variability
summary(lme_mod)
lme_mod2 = lmer(lifeExp ~ year + (1|continent), data = gapminder, REML = FALSE)
q()
reticulate::repl_python()
result
yes
reticulate::source_python('~/Desktop/floyd.py')
result
reticulate::repl_python()
reticulate::repl_python()
reticulate::source_python('~/Desktop/floyd.py')
result
graph
INF
q()
setwd("~/Dropbox/Github/datamed")
library(ISLR) # NCI60 data in this package
install.packages("ISLR")
library(ISLR) # NCI60 data in this package
class(NCI60)
nci.labs = NCI60$labs
head(nci.labs)
dim(nci.labs)
nci.data = NCI60$data
head(nci.data)
class(nci.data)
dim(nci.data)
class(nci.labs)
length(nci.labs)
length(unique(nci.labs))
?prcomp
library(ggplot2)
nci_pc_out = prcomp(nci.data, scale = TRUE) # scaling is done by dividing the (centered) columns of x by their standard deviations
?prcomp
class(nci_pc_out)
nci_pc_out
head(nci_pc_out)
pr = nci_pc_out$x
dim(pr)
pr[1:5, 1:5]
dim(pr)
pr[1:5, ]
nci_pc_out$rotation
dim(nci_pc_out$rotation)
out = prcomp(nci.data, scale = TRUE)
dim(out$rotation)
out$rotation[1:5, 1:5]
pc12scores = nci_pc_out$x[,c("PC1", "PC2")]
df = data.frame(cell_lines = nci.labs, pc12scores)
ggplot(data = df, aes(x=PC1, y=PC2, col = cell_lines)) + geom_point(size = 3)
dim(out$sdev)
length(out$sdev)
sum(out$sdev)
out = prcomp(nci.data, scale = TRUE)
library(ggplot2)
pr = out$x
dim(pr) # 64 samples, 64 principal components
pc12scores = pr[,c("PC1", "PC2")]
df = data.frame(cell_lines = nci.labs, pc12scores)
ggplot(data = df, aes(x=PC1, y=PC2, col = cell_lines)) + geom_point(size = 3)
df = read.csv("data/breast_cancer_wisconsin.csv")
head(df)
dim(df)
summary(df)
df = read.csv("data/wisconsin_breast_cancer.csv")
dim(df)
head(df)
df = read.csv("data/wisconsin_breast_cancer.csv")
dim(df)
df = read.csv("data/wisconsin_breast_cancer.csv")
dim(df)
head(df)
feature = df[,3:12]
dx = df$diagnosis
pca = prcomp(feature, scale = T)
result = pca$x
head(result)
dim(result)
head(result)
sub = result[,1:2]
pc12 = result[,1:2]
df2 = data.frame(diagnosis = dx, pc12)
df12 = data.frame(diagnosis = dx, pc12)
ggplot(data = df12, aes(x = PC1, y = PC2, col = diagnosis)) + geom_point()
df = read.csv("data/wisconsin_breast_cancer.csv")
# 주성분 분석을 한 변수 데이터만 분리
feature = df[,3:12] # 1,2 열은 각각 환자 ID, 진단(B: 양성, M:악성)
# 주성분 분석
pca = prcomp(feature, scale = T) # 변수 값을 표준화(평균을 빼고, 표준편차로 나누어줌)
result = pca$x # 각 환자별 주성분(PC1, PC2, ... PC10) 값
# 시각화
pc12 = result[,1:2] # PC1, PC2 선택
df12 = data.frame(diagnosis = df$diagnosis, pc12)
ggplot(data = df12, aes(x = PC1, y = PC2, col = diagnosis)) + geom_point()
library(ggplot2)
df = read.csv("data/wisconsin_breast_cancer.csv")
head(df)
# 주성분 분석을 한 변수 데이터만 분리
feature = df[,3:12] # 1,2 열은 각각 환자 ID, 진단(B: 양성, M:악성)
head(feature)
# 주성분 분석
pca = prcomp(feature, scale = T) # 변수 값을 표준화(평균을 빼고, 표준편차로 나누어줌)
class(pca)
pca
# 주성분 분석
pca = prcomp(feature, scale = T) # 변수 값을 표준화(평균을 빼고, 표준편차로 나누어줌)
result = pca$x # 각 환자별 주성분(PC1, PC2, ... PC10) 값
head(result)
dim(result)
# 시각화
pc12 = result[,1:2] # PC1, PC2 선택
ggplot(data = df12, aes(x = PC1, y = PC2, col = diagnosis)) + geom_point()
df12 = data.frame(diagnosis = df$diagnosis, pc12)
head(df12)
ggplot(data = df12, aes(x = PC1, y = PC2, col = diagnosis)) + geom_point()
q()
knitr::opts_chunk$set(echo = TRUE)
df_1952 = gapminder %>%
filter(year == 1952)
library(gapminder)
library(dplyr)
library(ggplot2)
df_1952 = gapminder %>%
filter(year == 1952)
cor.test(df_1952$gdpPercap, df_1952$lifeExp)
lm_1952 = lm(lifeExp ~ gdpPercap_log10, data = df_1952)
lm_1952 = lm(lifeExp ~ gdpPercap, data = df_1952)
summary(lm_1952)
lm_1952 = lm(lifeExp ~ gdpPercap, data = df_1952)
summary(lm_1952)
df_1952 = gapminder %>%
filter(year == 1952) %>%
mutate(gdpPercap_log10 = log10(gdpPercap))
cor.test(df_1952$gdpPercap_log10, df_1952$lifeExp)
lm_1952 = lm(lifeExp ~ gdpPercap_log10, data = df_1952)
summary(lm_1952)
confint(lm_1952, level = 0.95)
predictions = predict(lm_1952, newdata = df_1952, interval = "predict")
head(predictions)
df_pred = cbind(df_1952, predictions)
df_pred
head(df_pred)
df_1952 = gapminder %>%
filter(year == 1952) %>%
mutate(gdpPercap_log10 = log10(gdpPercap)) %>%
select(country, lifeExp, gdpPercap_log10)
df_pred = cbind(df_1952, predictions)
head(df_pred)
df_pred %>%
ggplot(aes(gdpPercap_log10, lifeExp)) +
geom_point() +
stat_smooth(method = "lm", level = 0.95) +
geom_line(aes(y=lwr), col = "red", linetype = "dashed") +
geom_line(aes(y=upr), col = "red", linetype = "dashed")
df_2002 = gapminder %>%
filter(year == 2002) %>%
select(lifeExp, gdpPercap) %>%
mutate(gdpPercap_log10 = log10(gdpPercap))
pred = predict(lm_1952, newdata = df_2002)
head(pred)
df = data.frame(obs = df_2002$lifeExp, prd = pred)
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0)
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
expand_limits(c(30, 90))
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
expand_limits(x = c(30, 90))
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
expand_limits(x = c(30, 90), y = c(30, 90))
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
expand_limits(x = c(30, 90), y = c(30, 90))
ggplot(df, aes(obs, prd)) +
geom_point() +
geom_abline(slope = 1, intercept = 0)
rmse(lm_1952)
rmse = function(x){
sqrt(sum((residuals(x)^2))/df.residual(x))
} # x <- model object
rmse(lm_1952)
head(lm_1952)
lm_2002 = lm(obs ~ prd, data = df)
head(df)
lm_2002 = lm(obs ~ prd, data = df)
rmse(lm_2002)
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum((sqe)/length(pred))))
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum((sqe)/(length(pred)-2))))
df.residual(lm_1952)
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum((sqe)/140)))
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
lm_2002 = lm(obs ~ prd, data = df)
rmse(lm_2002)
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
residuals(lm_1952)
head(df)
residuals(lm_2002)
head(df_1952)
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
prd_2002 = predict(lm_1952, newdata = df_2002,
interval ="confidence")
head(prd_2002)
head(df_1952)
predictions = predict(lm_1952, newdata = df_1952, interval = "predict")
head(predictions)
df_1952_pred = cbind(df_1952, predictions)
df_1952_pred %>%
ggplot(aes(gdpPercap_log10, lifeExp)) +
geom_point() +
stat_smooth(method = "lm", level = 0.95) +
geom_line(aes(y=lwr), col = "red", linetype = "dashed") +
geom_line(aes(y=upr), col = "red", linetype = "dashed")
head(df_1952_pred)
dim(df_1952_pred)
df_1952_predict %>%
mutate(sqe = (fit - lifeExp)^2) %>%
summarise(rmse = sqrt(sum(sqe)/142))
df_1952_pred = cbind(df_1952, predictions)
df_1952_pred %>%
ggplot(aes(gdpPercap_log10, lifeExp)) +
geom_point() +
stat_smooth(method = "lm", level = 0.95) +
geom_line(aes(y=lwr), col = "red", linetype = "dashed") +
geom_line(aes(y=upr), col = "red", linetype = "dashed")
df_1952_predict %>%
mutate(sqe = (fit - lifeExp)^2) %>%
summarise(rmse = sqrt(sum(sqe)/142))
df_1952_pred %>%
mutate(sqe = (fit - lifeExp)^2) %>%
summarise(rmse = sqrt(sum(sqe)/142))
df %>%
mutate(sqe = (pred - obs)^2) %>%
summarize(rmse = sqrt(sum(sqe)/140))
prd_2002 = predict(lm_1952, newdata = df_2002,
interval ="confidence")
head(prd_2002)
head(gapminder)
head(df_1952)
df_1952 = gapminder %>%
filter(year == 1952) %>%
mutate(gdpPercap_log10 = log10(gdpPercap))
head(df_1952)
lm_1952 = lm(lifeExp ~ gdpPercap_log10 + year + continent,
data = df_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + year + continent,
data = df_1952)
summary(lm2_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + year + continent,
data = df_1952)
summary(lm2_1952)
str(gapminder)
str(df_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + continent,
data = df_1952)
summary(lm2_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + continent + pop,
data = df_1952)
summary(lm2_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + continent,
data = df_1952)
summary(lm2_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10*continent,
data = df_1952)
summary(lm2_1952)
df_1952 %>%
ggplot(aes(gdpPercap_log10, lifeExp)) +
stat_smooth(method = "lm", level = 0.95) +
facet_wrap(~continent)
lm(gdpPercap_log10 ~ continent, data = df_1952)
col_mod = lm(gdpPercap_log10 ~ continent, data = df_1952)
summary(col_mod)
df_1952 %>%
ggplot(aes(continent, gdpPercap_log10)) +
geom_boxplot()
vif(lm2_1952)
library(car)
?vif
??vif
install.packages("car")
install.packages("car")
install.packages("car")
knitr::opts_chunk$set(echo = TRUE)
library(car)
vif(lm2_1952)
vif(lm2_1952, type = 'predictor')
vif(lm2_1952)
install.packages("DAAG")
library(DAAG)
vif(lm2_1952)
lm3_1952 = lm(lifeExp ~ gdpPercap_log10*continent,
data = df_1952)
summary(lm3_1952)
lm2_1952 = lm(lifeExp ~ gdpPercap_log10 + continent,
data = df_1952)
summary(lm2_1952)
vif(lm2_1952)
library(car)
vif(lm2_1952)
car::vif(lm2_1952)
car::vif(lm3_1952)
car::vif(lm3_1952, type = 'predictor')
library(car)
car::vif(lm3_1952, type = 'predictor')
car::vif(lm2_1952)
q()
